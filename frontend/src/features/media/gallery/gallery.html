<div class="space-y-6 mb-6">
    <h2 class="text-3xl w-full font-semibold tracking-tight p-2 mb-2">Gallery</h2>

    <div class="border border-base-200/80 w-full rounded-xl p-5 bg-base-100/60 flex flex-col md:flex-row items-start md:items-center md:justify-between gap-4 overflow-visible">
        <div class="flex flex-col md:flex-row items-start md:items-center gap-5  w-full md:w-auto min-w-0">
            <div class="whitespace-nowrap text-lg font-medium pr-2">Filter by:</div>
            <select class="select select-bordered select-md w-full md:w-48 min-w-0 truncate" [(ngModel)]="filterUser">
                <option value="">All</option>
                @for(u of users(); track u) {
                    <option [value]="u">{{ u }}</option>
                }
            </select>
            <input type="date" class="input input-bordered input-md w-full md:w-48 min-w-0" [(ngModel)]="filterDate" [max]="maxDate" (ngModelChange)="onDateModelChange($event)" />
        </div>

        <div class="w-full md:w-auto">
            <button class="btn btn-md btn-primary w-full md:w-auto" (click)="openAddModal()">Add new media</button>
        </div>
    </div>

    @if (filteredImages().length) {
        <div class="flex justify-end px-4 sm:px-0">
            <app-paginator
                [(pageNumber)]="pageNumber"
                [(pageSize)]="pageSize"
                [totalCount]="totalCount()"
                [totalPages]="totalPages()"
                [pageSizeOptions]="[8, 12, 16, 24]"
                (pageChange)="onPageChange($event)" 
            />
        </div>
    }

    <dialog #uploadModal class="modal modal-bottom sm:modal-middle">
        <div class="modal-box">
            <h3 class="text-lg font-bold text-center">Add new media</h3>
            <div class="py-4">
                <app-image-upload (uploadFile)="onModalUpload($event)" />
            </div>
            <div class="modal-action">
                <button class="btn" (click)="uploadModal.close()">Close</button>
            </div>
        </div>
        <form method="dialog" class="modal-backdrop"><button></button></form>
    </dialog>

    <dialog #previewModal class="modal sm:modal-middle">
        <div class="modal-box p-0">
            @if (selectedImage) {
                <img [src]="selectedImage.url" [alt]="selectedImage.uploadByUsername || 'image'" class="w-full h-full object-contain" (click)="closePreview()" />
            }
        </div>
        <form method="dialog" class="modal-backdrop" (click)="closePreview()"><button></button></form>
    </dialog>

    <app-confirm-dialog />

    @if (loading()) {
        <div class="flex items-center justify-center gap-2 text-base-content/60 text-sm py-12">
            <span class="loading loading-spinner loading-sm"></span>
            Loading images...
        </div>
    } @else if (!filteredImages().length) {
        <div class="text-base-content/60 text-lg text-center py-8">No images found</div>
    } @else {
        <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4">
            @for(img of paginatedImages(); track img.mediaId) {
                <app-media-card [media]="img" (click)="openPreview(img)" (delete)="onDelete($event)" />
            }
        </div>
    }
</div>