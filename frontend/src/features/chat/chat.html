<div class="fixed inset-0 pt-20">
    <div class="flex flex-col h-full">
        <div class="p-5 flex dark:bg-gray-800">
            <div class="font-medium text-center md:text-left w-full flex items-center justify-between">
                <span>Family Chat</span>
                <div class="flex items-center h-8">
                    @if (isConnecting()) {
                        <div class="flex items-center h-full">
                            <span class="text-sm text-gray-500">Connecting</span>
                            <span class="text-sm text-gray-500 font-mono w-6 text-left">{{ connectingDots() }}</span>
                        </div>
                    } @else if (isDisconnected()) {
                        <div class="flex items-center gap-2 h-full">
                            <span class="inline-flex w-2 h-2 bg-red-500 rounded-full"></span>
                            <span class="text-sm text-red-500">Disconnected</span>
                            <button class="btn btn-ghost btn-xs p-1 h-6 min-h-6 ml-1" (click)="retryConnection()" title="Retry connection">
                                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-3">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M16.023 9.348h4.992v-.001M2.985 19.644v-4.992m0 0h4.992m-4.993 0 3.181 3.183a8.25 8.25 0 0 0 13.803-3.7M4.031 9.865a8.25 8.25 0 0 1 13.803-3.7l3.181 3.182m0-4.991v4.99" />
                                </svg>
                            </button>
                        </div>
                    }
                </div>
            </div>
        </div>
        <div class="flex flex-col flex-grow overflow-auto p-4 mb-24 md:mb-0">
            @for (message of messages(); track message.id) {
                <div class="chat group" [class.chat-start]="message.senderType !== 'PARENT'" [class.chat-end]="message.senderType === 'PARENT'">
                    <div class="chat-image avatar">
                        <div class="w-10 h-10 rounded-full bg-primary/90 text-primary-content font-semibold shadow-md ring ring-offset-2 ring-offset-base-100 dark:bg-primary dark:text-white">
                            <div class="w-full h-full flex items-center justify-center text-white font-semibold text-sm leading-none">
                                {{ getSenderInitial(message) }}
                            </div>
                        </div>
                    </div>
                    <div class="chat-header text-gray-800 dark:text-gray-200">
                        {{ getSenderName(message) }}
                    </div>
                    <div class="chat-bubble bg-gray-200 dark:bg-gray-800 text-gray-900 dark:text-gray-100">
                        {{ message.content }}
                    </div>
                    <div class="chat-footer opacity-0 invisible group-hover:opacity-50 group-hover:visible text-gray-600 dark:text-gray-400 transition-opacity duration-150">
                        <time class="text-xs">
                            {{ message.sentAt | timeAgo }}
                        </time>
                    </div>
                </div>
            }
            <div #messageEndRef></div>
        </div>
        <div class="flex join w-full p-4 border-t border-gray-300 dark:border-gray-700 bg-white dark:bg-gray-800 md:static fixed bottom-0 left-0 right-0 md:bottom-auto md:left-auto md:right-auto z-30">
            <input [(ngModel)]="messageContent" class="input input-bordered w-full join-item bg-gray-100 dark:bg-gray-900 text-gray-900 dark:text-gray-100 border-gray-300 dark:border-gray-700" placeholder="Type a message..." (keydown.enter)="sendMessage()" [disabled]="isConnecting()">
            <button (click)="sendMessage()" type="submit" class="btn btn-primary join-item" [disabled]="!messageContent().trim() || isConnecting()">
                Send
            </button>
        </div>
    </div>
</div>